---
import Layout from "../layouts/Layout.astro";

const keys = ['A','B','C','D', 'E', 'F', 'G' ]
const meter = []

---

<Layout title="Teacher View">
    
    <section class="main-container flex flex-col justify-items-center mx-auto max-w-screen-md">
        <h2 class="text-3xl">Teacher Mode</h2>
        <div id="input-fields" class="flex flex-col sm:flex-row ">

            <div id="meter-radio" class="items-center justify-center">
                <label for="keys" class="block mb-2 text-sm font-medium">Select a meter:</label>
                <div class="flex items-center mb-4">
                    <input checked id="meter-radio-1" type="radio" value="" name="meter-radio" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                    <label class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">4/4</label>
                </div>
                <div class="flex items-center">
                    <input id="meter-radio-2" type="radio" value="" name="meter-radio" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                    <label for="meter-radio-2" class="ml-2 text-sm font-mediu">3/4</label>
                </div>
            </div>

            <div id="mode-radio" class="items-center justify-center">
                <label for="keys" class="block mb-2 text-sm font-medium">Select a mode:</label>
                <div class="flex items-center mb-4">
                    <input checked id="default-radio-1" type="radio" value="" name="default-radio" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                    <label class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">Major</label>
                </div>
                <div class="flex items-center">
                    <input id="default-radio-2" type="radio" value="" name="default-radio" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                    <label for="default-radio-2" class="ml-2 text-sm font-mediu">Minor</label>
                </div>
            </div>
            <div id="key-select" class="flex flex-col max-w">
                <label for="keys" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Select a Key:</label>
                <select id="keys" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                <option selected>Choose Key</option>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="D">D</option>
                <option value="E">E</option>
                <option value="F">F</option>
                <option value="G">G</option>
                </select>
            </div>
            <div class="flex items-center justify-start">
                <button id="generate-button" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 border border-blue-700 rounded">
                  Generate
                </button>
            </div>   
            
            
        </div>
        
        <div id="playback-buttons" class="flex ">
            <button id="play-button" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 border border-blue-700 rounded">
                Play
            </button>
            <button id="pause-button" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 border border-blue-700 rounded">
                Pause
            </button>
        </div>
        <div id="music-fields" class="flex grid grid-cols-1 w-full">
            <label>Music Sheet</label>
            
            <div id="notation" class="overflow-x-auto">
            </div>
            Input Area:
            <div id="abc-text-area" class="">
                <textarea id="notation-input" class="w-full h-full"></textarea>
            </div>
        </div>

    </section>

    <script >
        import abcjs from "abcjs";

        const abc = `X:1
T:Example
M:4/4
C:Trad.
K:G
|:GABc dedB|dedB dedB|c2ec B2dB|c2A2 A2BA|
GABc dedB|dedB dedB|c2ec B2dB|A2F2 G4:|
|:g2gf gdBd|g2f2 e2d2|c2ec B2dB|c2A2 A2df|
g2gf g2Bd|g2f2 e2d2|c2ec B2dB|A2F2 G4:|`;

        const notationInput = document.querySelector('#notation-input');
        const notation = document.querySelector('#notation');

        //notationInput.value = abc;
        //abcjs.renderAbc(notation, abc);

        //notationInput.addEventListener('input', () => {
        //    abcjs.renderAbc(notation, notationInput.value);
        //});
        
        
        const textarea = document.querySelector("textarea");
        const maxHeight = 400; // specify the maximum height in pixels
        
        const setTextAreaHeight = ()=>{
            textarea.style.height = "auto";
            textarea.style.height = Math.min(textarea.scrollHeight, maxHeight) + "px";
        }
        setTextAreaHeight()
        textarea.addEventListener("input",setTextAreaHeight );


    </script>
    
    <script client:load>
        const svg = document.querySelector("#notation svg");
        if (svg) {
            svg.classList.add("w-full");
            console.log("SVG found!!!")
        }
        else{
            console.log("No SVG found :/")
        }

    </script>

    <script >
        import {generateExercise} from "../scripts/exerciseManager"
        import {renderAbc,playTune} from "../scripts/exercisePlayer"
        
        let new_song = await generateExercise('header')

        const notation = document.querySelector('#notation');
        renderAbc(notation,new_song)
        console.log("rendered song")
        const playButton = document.querySelector("#play-button");
        playButton.addEventListener("click",() => {
            console.log("play clicked!")
            playTune() 
        });
        const pauseButton = document.querySelector("#pause-button");
        pauseButton.addEventListener("click",() =>{
            console.log("pause clicked!")    
            playTune() 
        });
    </script>
</Layout>


<style>
    #input-fields{
        background-color: yellowgreen
        
    }

    #input-fields > div{
        border-width: 1rem;
        background-color: #c487e3;
    }

    #notation{
        background-color: beige;
        overflow-x: auto;
        overflow-y: auto;
        width: 100%;
    }

    #notation:first-child{
        background: #c487e3;
        width: 100%;
        height: 100%;
    }

    svg {
        background-color: yellow;
    }

    #playback-buttons{
        background-color: tomato;
    }

    #abc-text-area{
        padding-block: 1em;
        background-color: blueviolet;
    }

    #music-fields{
        background-color: aqua;
    }

</style>